#!/usr/bin/env bash

set -e

OS=$(awk -F= '/^NAME/{print $2}' /etc/os-release)
OS="${OS%\"}"
OS="${OS#\"}"

# Confirm sudo
sudo echo

if [ "$OS" = "Ubuntu" ]; then
	sudo add-apt-repository ppa:neovim-ppa/unstable -y
	#sudo add-apt-repository ppa:papirus/papirus -y
	sudo apt update
	sudo apt upgrade -y
	sudo apt install -y build-essential papirus-icon-theme neofetch kitty python3-pip tmux curl python3-virtualenvwrapper fd-find telegram-desktop htop systemd-coredump gnome-tweaks zsh zoxide exa bat unar
	sudo apt autoremove -y
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y

	sudo update-alternatives --set x-terminal-emulator /usr/bin/kitty

	cd /tmp
	curl -LO https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/JetBrainsMono.zip
	unar JetBrainsMono.zip
	rm -rf  ~/.fonts
  mkdir ~/.fonts
	mv /tmp/JetBrainsMono/*.ttf ~/.fonts/
	fc-cache -fv

	curl -LO https://github.com/EliverLara/Nordic/releases/download/v2.1.0/Nordic-v40.tar.xz
	unar Nordic-v40.tar.xz
	rm -rf  ~/.themes
  mkdir ~/.themes
	mv /tmp/Nordic-v40 ~/.themes/

	rm -rf  ~/.icons
  mkdir ~/.icons
	wget -cO- https://github.com/phisch/phinger-cursors/releases/latest/download/phinger-cursors-variants.tar.bz2 | tar xfj - -C ~/.icons

	git clone https://github.com/Adapta-Projects/Papirus-Nord
	cd Papirus-Nord
	sudo sh -c "yes | ./papirus-folders -t Papirus-Dark"
	sudo ./install
else
  sudo pacman -Syu --noconfirm --needed git base-devel
  git clone https://aur.archlinux.org/yay.git
  cd yay
  makepkg -sri --needed --noconfirm
  cd ..
  rm -rf .cache yay

	yay -Sy --noconfirm --answerdiff=None git neofetch kitty neovim python-pip tmux curl python-virtualenvwrapper fd exa telegram-desktop htop zsh zoxide papirus-nord nerd-fonts-jetbrains-mono phinger-cursors papirus-nord bat pyright rustup rust-analyzer openssh python-pip gtk3 gtk4 neovim-remote unzip npm figlet
fi

~/.local/bin/theme_switch || true

git config --global user.email "stadnikandriy1@gmail.com"
git config --global user.name "Stadnik Andrii"

ssh-keygen -t ed25519 -q -N "" -f ~/.ssh/id_ed25519 \

zsh -ic "mkvirtualenv neovim; pip install pynvim"

pip install sourcery-cli

export TMUX_PLUGIN_MANAGER_PATH='$HOME/.tmux/plugins/'
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
~/.tmux/plugins/tpm/bin/install_plugins

rustup default nightly

# Install Packer
nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
nvim --headless -c 'TSUpdateSync' -c 'sleep 300' -c 'qa'
